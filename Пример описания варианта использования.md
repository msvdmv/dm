# Описание варианта использования

## Основной поток
1. __Если__ пользователь является сотрудникомFUN&SUN (проверяем по доменту @fstravel.com)
2. Заблокировать кнопку "Сгенировать промокод"
3. Проверить, что пользователь уже попал в сегмент "Сотрудник" в майндбокс (запрос Registration-Form-DetskiyMir)
4. __Если__ пользователь уже попал в сегмент "Сотрудники"
5. Разблокировать "Сгенировать промокод"
6. Пользователь нажимает кнопку "Сгенировать промокод"
7. Фронт отправляет запрос для генерации промокода, пример запроса: https://apigate.fstravel.com/api/v1/client/send-ref-promocode?email=dm@fstravel.com&pointOfContact=b2c:ru
8. Фронт получает в ответ статус 200
9. Бэк добавляет в запрос айди запроса, который генерит на своей стороне и передает его в поле "IDsendrefcode". Отправляет запрос в Майндбокс
10. Майндбокс применяет логику выдачи промокода к полученному запросу. По итогу, отправляет вебхук в сторону бэка.
11. Бэк сохраняет содержимое вебхука, для мапинга запрос - вебхук используется айди запроса.
12. Фронт запрашивает содежимое вебхука у бэка.
13. Бэк возвращает содержимое.
14. Клиент видит содержимое на странице генерации промокода 

## Альтернативный поток

__1.а.__ Если пользователь не является сотрудником FUN&SUN
1. Управление переходит на шаг 6

__4.а.__ Если пользователь еще не попал в сегмент "Сотрудники"
1. Показать пользователю сообщение "Добавляем вас в нужный сегмент"
2. Проверить, что пользователь уже попал в сегмент "Сотрудник" в майндбокс (запрос Registration-Form-DetskiyMir)
3. Если пользователь попал в сегмент "Сотрудники" - управление переходит на шаг 4
4. Если пользователь не попал в сегмент "Сотрудники". Перейти к пункту 4.а.1. (повторять в течение 10 минут)

## Поток исключения

__4.б.__ Если пользователь не попал в сегмент "Сотрудники" по истечению 10 минут.
1. Показать пользователю сообщение "К сожалению, нам не обойтись без помощи коллег) Просим вас написать на почту it.fstravel.com."
2. Система завершает процесс генерации промокода